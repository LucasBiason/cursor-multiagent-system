---
alwaysApply: true
---

# programming rules - mandatory for all agents

> **this file contains all programming rules that apply to all agents working with code.**
> **this is the most important document for any agent that touches code.**
> **always reference this file before writing any code.**

---

## ğŸš€ criar api do zero

**quando o usuÃ¡rio pedir uma api, seguir a estrutura exata em `QUICK_START_API.md`**

### estrutura obrigatÃ³ria

**django:**
```
app/
â”œâ”€â”€ models/              # model django
â”œâ”€â”€ repositories/        # acesso ao orm
â”œâ”€â”€ validators/          # validaÃ§Ã£o de entrada
â”œâ”€â”€ controllers/         # lÃ³gica de negÃ³cio
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ urls.py         # rotas (com /api/v1/)
â”‚   â”œâ”€â”€ views.py        # views da api
â”‚   â””â”€â”€ serializers.py  # serializers drf
â””â”€â”€ urls.py             # urls principais
```

**fastapi:**
```
app/
â”œâ”€â”€ models/              # model sqlalchemy
â”œâ”€â”€ repositories/        # acesso ao orm
â”œâ”€â”€ validators/          # validaÃ§Ã£o de entrada
â”œâ”€â”€ controllers/         # lÃ³gica de negÃ³cio
â”œâ”€â”€ schemas/             # pydantic models
â””â”€â”€ routers/             # rotas (com /api/v1/)
```

### regras crÃ­ticas ao criar api

1. **sempre criar todas as camadas:** model â†’ repository â†’ validator â†’ controller â†’ api view/router
2. **nunca pular camadas:** nÃ£o fazer lÃ³gica na view, nÃ£o acessar orm direto
3. **versionamento obrigatÃ³rio:** todas as apis em `/api/v1/`
4. **seguir estrutura exata:** ver `QUICK_START_API.md` para exemplos completos

**guia completo:** `core/docs/programming/QUICK_START_API.md`

---

## ğŸ“š documentaÃ§Ã£o completa

**toda a documentaÃ§Ã£o detalhada estÃ¡ em `core/docs/programming/` organizada por Ã¡rea de conhecimento.**

### estrutura de documentaÃ§Ã£o

```
core/docs/programming/
â”œâ”€â”€ README.md              # Ã­ndice completo
â”œâ”€â”€ QUICK_START_API.md     # â­ guia passo a passo para criar api
â”œâ”€â”€ python.md              # python, django, fastapi
â”œâ”€â”€ typescript.md          # typescript, react, frontend
â”œâ”€â”€ git.md                 # git workflow, commits, branches
â”œâ”€â”€ api-rest.md            # api rest, endpoints, versionamento
â”œâ”€â”€ architecture.md        # padrÃµes arquiteturais, mvc
â”œâ”€â”€ devops.md              # docker, deploy, ci/cd
â”œâ”€â”€ testing.md            # testes, tdd, cobertura
â”œâ”€â”€ security.md            # seguranÃ§a, secrets, validaÃ§Ã£o
â”œâ”€â”€ mcp.md                 # model context protocol
â””â”€â”€ code-quality.md        # clean code e qualidade
```

**sempre consultar a documentaÃ§Ã£o especÃ­fica antes de implementar.**

---

## regras gerais de cÃ³digo

**documentaÃ§Ã£o completa:** `core/docs/programming/code-quality.md`

### cÃ³digo
- **sem emojis** em cÃ³digo (python, javascript, css, html, configs)
- **zero emojis em projetos de trabalho/work** (qualquer parte do cÃ³digo)
- emojis apenas em README.md e notebooks jupyter para estudos
- **comentÃ¡rios e docstrings em inglÃªs** (exceto notebooks de ensino)
- **typescript** para frontend (nunca javascript)
- **python type hints obrigatÃ³rios** (todas as funÃ§Ãµes)
- **linha mÃ¡xima 79 caracteres** - obrigatÃ³rio (PEP 8 E501)
- nÃ£o modificar migrations django manualmente
- nÃ£o modificar arquivos de config sem solicitaÃ§Ã£o explÃ­cita
- **documentaÃ§Ã£o completa:** `core/docs/programming/EMOJIS_RULES.md`

### clean code e qualidade
- **nomenclatura descritiva** (sem abreviaÃ§Ãµes confusas)
- **funÃ§Ãµes pequenas** (< 20 linhas quando possÃ­vel)
- **uma funÃ§Ã£o, uma responsabilidade**
- **sem cÃ³digo duplicado** (princÃ­pio DRY)
- **erros tratados explicitamente** (nunca except genÃ©rico)
- **sem nÃºmeros mÃ¡gicos** (usar constantes nomeadas)
- **complexidade baixa** (poucos ifs aninhados)
- **sempre consultar** `code-quality.md` para padrÃµes detalhados

### organizaÃ§Ã£o de arquivos
- **project readme.md:** apenas um na raiz do projeto
- **documentaÃ§Ã£o:** `docs/` ou `docs-private/` dentro do projeto
- **test files** (`test_*.py`, `*_test.py`): `Scripts e Deploys/` (nunca na raiz)
- **shell scripts** (`.sh`): `Scripts e Deploys/` (nunca na raiz)
- **nunca criar** mÃºltiplos readme ou scripts de teste na raiz
- **nunca criar** arquivos de documentaÃ§Ã£o na raiz

---

## python

**documentaÃ§Ã£o completa:** `core/docs/programming/python.md`

### regras crÃ­ticas
- **type hints obrigatÃ³rios** em todas as funÃ§Ãµes
- **docstrings** em padrÃ£o google style (inglÃªs)
- **preferir funÃ§Ãµes** quando possÃ­vel (classes apenas quando necessÃ¡rio)
- **mÃ©todos estÃ¡ticos** em controllers e repositories

### padrÃµes obrigatÃ³rios
- **repository pattern** â†’ ver `core/docs/programming/architecture.md` e `python.md`
- **controller pattern** â†’ ver `core/docs/programming/architecture.md` e `python.md`
- **validators** â†’ ver `core/docs/programming/architecture.md` e `python.md`
- **sql puro apenas para select** â†’ ver `core/docs/programming/python.md`

### django
- **estrutura obrigatÃ³ria:** seguir User Service do ExpenseIQ como modelo
- **static files:** adicionar em `urls.py` (DEBUG) e usar `collectstatic` + nginx (produÃ§Ã£o)
- **documentaÃ§Ã£o:** sempre incluir swagger, redoc e admin em `urls.py`
- **error handlers:** usar template de `src/handlers.py` (nÃ£o retornar HTML de erro 500)
- **health check:** sempre implementar endpoint retornando service, version, dt
- **arquivos padronizados:** usar `cache_system.py`, `database.py`, `handlers.py` do ExpenseIQ
- **template completo:** `core/templates/django/DJANGO_SERVICE_TEMPLATE.md`
- **documentaÃ§Ã£o completa:** `core/docs/programming/DJANGO_RULES.md`

### fastapi
- pydantic models para validaÃ§Ã£o
- dependency injection para auth e database
- `apirouter` para organizaÃ§Ã£o de rotas
- `httpexception` para erros
- **sempre consultar** `python.md` para padrÃµes detalhados

### testing
- **pytest obrigatÃ³rio** (em funÃ§Ãµes, nÃ£o classes)
- **estrutura espelhada:** `app/users/controllers/user_controller.py` â†’ `tests/users/controllers/test_user_controller.py`
- **mocks obrigatÃ³rios:** banco, fila, cache, APIs externas (nunca usar recursos reais)
- **coverage mÃ­nimo 90% por arquivo** (nÃ£o Ã© mÃ©dia, cada arquivo individualmente)
- **pytest.ini e conftest.py:** usar templates em `core/templates/django/`
- **documentaÃ§Ã£o completa:** `core/docs/programming/TESTING_RULES.md`

---

## typescript e react

**documentaÃ§Ã£o completa:** `core/docs/programming/typescript.md`  
**documentaÃ§Ã£o react:** `core/docs/programming/typescript.md`

### regras crÃ­ticas
- **typescript obrigatÃ³rio** (nunca javascript)
- **absolute imports** obrigatÃ³rio (`@/components`, `@/hooks`, etc.)
- **function components** obrigatÃ³rio (classes apenas para error boundaries)
- **react.memo** para performance (quando apropriado)
- **usecallback** para handlers e hooks customizados
- **tailwind css** obrigatÃ³rio (nunca css inline)
- **frontend ecosystem:** consultar `core/docs/programming/typescript.md`
  - Gerenciamento de estado (useState, useReducer, Context, Zustand)
  - Performance (code splitting, virtual scrolling)
  - TypeScript avanÃ§ado (generics, type guards)
  - Testes e estrutura de projeto

### nomenclatura
- **pascalcase** para componentes e types
- **camelcase** para variÃ¡veis e funÃ§Ãµes
- **prefixo `handle`** para funÃ§Ãµes de evento
- **prefixos booleanos** (`is`, `has`, `can`)

### css e estilos
- **pasta `styles/`** com arquivos separados por tipo (app.css, componentes.css, dashboard.css, table.css, menu.css)
- **versÃµes `.min.css` obrigatÃ³rias** de cada arquivo
- **carregar apenas `.min.css` em produÃ§Ã£o** (nunca versÃ£o legÃ­vel)
- **carregar apenas arquivos necessÃ¡rios** em cada pÃ¡gina
- **django:** usar `collectstatic` e servir via nginx em produÃ§Ã£o
- **documentaÃ§Ã£o completa:** `core/docs/programming/CSS_RULES.md`

---

## git workflow

**documentaÃ§Ã£o completa:** `core/docs/programming/git.md`

### regras crÃ­ticas
- **feature branches** obrigatÃ³rio
- **mensagens de commit** descritivas com tipo
- **pull requests** sempre revisados antes de merge
- **nunca force push** para main
- **sempre rodar testes** antes de commit

### tipos de commit
- `feat`: nova feature
- `fix`: correÃ§Ã£o de bug
- `refactor`: refatoraÃ§Ã£o
- `docs`: documentaÃ§Ã£o
- `test`: testes
- `chore`: manutenÃ§Ã£o

---

## api rest

**documentaÃ§Ã£o completa:** `core/docs/programming/api-rest.md`

### regras crÃ­ticas
- **versionamento obrigatÃ³rio:** `/{app}/api/v1/{resource}/`
- **resource-oriented design:** urls representam recursos, nÃ£o aÃ§Ãµes
- **http methods** corretos (get, post, put, patch, delete)
- **status codes** apropriados (200, 201, 204, 400, 401, 403, 404, 409, 422, 429, 500)
- **pagination obrigatÃ³ria** para list endpoints
- **serializaÃ§Ã£o** via serializers (django) ou pydantic (fastapi)

### anti-patterns (nunca fazer)
- âŒ action verbs in urls
- âŒ mixed naming conventions
- âŒ generic error messages
- âŒ returning html on api errors
- âŒ exposing stack traces
- âŒ no pagination on list endpoints
- âŒ n+1 queries
- âŒ no rate limiting

---

## arquitetura

**documentaÃ§Ã£o completa:** `core/docs/programming/architecture.md`

### padrÃµes obrigatÃ³rios

#### repository pattern
- **obrigatÃ³rio** para todo acesso ao orm
- **nunca** acessar orm diretamente em views/controllers
- **localizaÃ§Ã£o:** `app/repositories/`
- **documentaÃ§Ã£o:** `core/docs/programming/architecture.md` (seÃ§Ã£o repository pattern)

#### controller pattern
- **obrigatÃ³rio** para toda lÃ³gica de negÃ³cio
- **views/apis** sÃ£o apenas entry points
- **localizaÃ§Ã£o:** `app/controllers/`
- **documentaÃ§Ã£o:** `core/docs/programming/architecture.md` (seÃ§Ã£o controller pattern)

#### validators
- **obrigatÃ³rio** para toda validaÃ§Ã£o de entrada
- **controllers** nunca fazem validaÃ§Ã£o inline
- **localizaÃ§Ã£o:** `app/validators/` ou `app/api/validators.py`
- **documentaÃ§Ã£o:** `core/docs/programming/architecture.md` (seÃ§Ã£o validators)

#### separaÃ§Ã£o views
- **template views** em `views.py` (apenas servir html)
- **api views** em `api/views.py` (endpoints rest)
- **documentaÃ§Ã£o:** `core/docs/programming/architecture.md` (seÃ§Ã£o separaÃ§Ã£o views)

### nomenclatura
- **service** = external api
- **processor** = internal processing
- **documentaÃ§Ã£o:** `core/docs/programming/architecture.md` (seÃ§Ã£o nomenclatura)

### retornos
- **controllers** retornam objetos (nÃ£o dicts com 'success'/'error')
- **apis** serializam e definem http status
- **documentaÃ§Ã£o:** `core/docs/programming/architecture.md` (seÃ§Ã£o retornos)

---

## seguranÃ§a

**documentaÃ§Ã£o completa:** `core/docs/programming/security.md`

### regras crÃ­ticas
- **nunca commitar secrets** (todos em `.env.passwords` gitignored)
- **variÃ¡veis de ambiente** para todos os dados sensÃ­veis
- **validaÃ§Ã£o de entrada** na camada de validator
- **sql injection prevention** (orm ou parÃ¢metros, nunca concatenaÃ§Ã£o)
- **authentication/authorization** adequada
- **rate limiting** em todos os endpoints

### secrets management
- **documentaÃ§Ã£o:** `core/docs/programming/security.md` (seÃ§Ã£o secrets management)
- **arquivo:** `core/config/.env.passwords` (gitignored)
- **exemplo:** `core/config/.env.example`

---

## testing

**documentaÃ§Ã£o completa:** `core/docs/programming/testing.md`

### regras crÃ­ticas
- **tdd approach** (testes primeiro quando possÃ­vel)
- **unit tests** para componentes isolados
- **integration tests** para fluxo completo
- **cobertura mÃ­nima de 80%**
- **todos os testes passando** antes de merge
- **nunca commitar** testes quebrados

---

## devops

**documentaÃ§Ã£o completa:** `core/docs/programming/devops.md`

### regras crÃ­ticas
- **staging first** (sempre testar em staging antes de produÃ§Ã£o)
- **environment variables** para configuraÃ§Ãµes
- **docker secrets** em `.env` (gitignored)
- **migrations validadas** antes de deploy
- **rollback plan** sempre pronto
- **monitoramento** apÃ³s deploy

### docker, compose, entrypoint e makefile
- **dockerfile:** multi-stage builds, usuÃ¡rio nÃ£o-root, healthchecks
- **docker compose:** healthchecks, depends_on com conditions, volumes nomeados
- **entrypoint:** aguardar dependÃªncias, rodar migrations, validar configs
- **makefile:** automaÃ§Ã£o de tarefas comuns (up, down, test, shell, etc)
- **sempre consultar** `devops.md` para padrÃµes detalhados

---

## mcp (model context protocol)

**documentaÃ§Ã£o completa:** `core/docs/programming/mcp.md`

### estrutura
- tools em `src/tools/`
- services em `src/services/`
- custom implementations em `src/custom/`
- utils em `src/utils/`
- exceptions em `src/exceptions/`

### best practices
- validaÃ§Ã£o de entrada em todas as tools
- error handling adequado
- logging estruturado
- formataÃ§Ã£o de dados consistente

---

## regra fundamental: modificaÃ§Ã£o de cÃ³digo

**documentaÃ§Ã£o completa:** `core/docs/programming/CODE_MODIFICATION_RULES.md`

### sÃ³ alterar o que foi pedido
- **alterar apenas o que foi explicitamente solicitado**
- **nÃ£o fazer alteraÃ§Ãµes "melhorias" nÃ£o solicitadas**
- **nÃ£o remover cÃ³digo que nÃ£o foi pedido para remover**
- **nÃ£o adicionar funcionalidades que nÃ£o foram solicitadas**
- **nÃ£o refatorar cÃ³digo que nÃ£o foi pedido para refatorar**

### proibiÃ§Ãµes absolutas
- nunca remover cÃ³digo existente sem solicitaÃ§Ã£o
- nunca adicionar novas funcionalidades sem solicitaÃ§Ã£o
- nunca refatorar cÃ³digo sem solicitaÃ§Ã£o
- nunca alterar estrutura de arquivos sem solicitaÃ§Ã£o
- nunca modificar configuraÃ§Ãµes existentes sem solicitaÃ§Ã£o
- nunca alterar nomes de variÃ¡veis/funÃ§Ãµes/classes sem solicitaÃ§Ã£o

---

## templates de configuraÃ§Ã£o

**todos os templates estÃ£o em `core/templates/` organizados por tipo de projeto.**

### django
- `core/templates/django/entrypoint.sh` - entrypoint sem cores/emojis
- `core/templates/django/Dockerfile.dev` - dockerfile desenvolvimento
- `core/templates/django/Dockerfile.prod` - dockerfile produÃ§Ã£o
- `core/templates/django/.editorconfig` - configuraÃ§Ã£o editor
- `core/templates/django/.flake8` - configuraÃ§Ã£o flake8
- `core/templates/django/pytest.ini` - configuraÃ§Ã£o pytest
- `core/templates/django/conftest.py` - configuraÃ§Ã£o conftest
- `core/templates/django/pyproject.toml` - configuraÃ§Ã£o pyproject
- `core/templates/.gitignore` - gitignore completo

### estrutura configs/
- `configs/docker-compose.dev.yml` - compose desenvolvimento
- `configs/docker-compose.prod.yml` - compose produÃ§Ã£o
- `configs/nginx.conf` - configuraÃ§Ã£o nginx
- `configs/.env.development` - variÃ¡veis desenvolvimento
- `configs/.env.production` - variÃ¡veis produÃ§Ã£o
- `configs/.env.database` - variÃ¡veis banco de dados (se usar container)
- outros serviÃ§os: `.env.redis`, `.env.kafka`, `.env.mongodb` (se necessÃ¡rio)
- **documentaÃ§Ã£o:** `core/templates/django/configs/README.md`

---

## referÃªncias rÃ¡pidas

### padrÃµes obrigatÃ³rios
- repository pattern â†’ `core/docs/programming/architecture.md` e `python.md`
- controller pattern â†’ `core/docs/programming/architecture.md` e `python.md`
- validators â†’ `core/docs/programming/architecture.md` e `python.md`
- api versioning â†’ `core/docs/programming/api-rest.md`
- sql puro apenas select â†’ `core/docs/programming/python.md` (seÃ§Ã£o sql puro)

### regras crÃ­ticas
- sem emojis no cÃ³digo â†’ `core/docs/programming/EMOJIS_RULES.md`
- sÃ³ alterar o que foi pedido â†’ `core/docs/programming/CODE_MODIFICATION_RULES.md`
- type hints obrigatÃ³rios â†’ `core/docs/programming/python.md`
- absolute imports â†’ `core/docs/programming/typescript.md`
- secrets em .env â†’ `core/docs/programming/security.md`

### documentaÃ§Ã£o detalhada
- **guia completo de boas prÃ¡ticas** â†’ `core/docs/programming/BEST_PRACTICES.md`
- python completo â†’ `core/docs/programming/python.md`
- typescript/react completo â†’ `core/docs/programming/typescript.md`
- git workflow â†’ `core/docs/programming/git.md`
- api rest â†’ `core/docs/programming/api-rest.md`
- arquitetura â†’ `core/docs/programming/architecture.md`
- seguranÃ§a â†’ `core/docs/programming/security.md`
- testing â†’ `core/docs/programming/TESTING_RULES.md`
- css â†’ `core/docs/programming/CSS_RULES.md`
- django â†’ `core/docs/programming/DJANGO_RULES.md`
- devops completo â†’ `core/docs/programming/devops.md`
- mcp â†’ `core/docs/programming/mcp.md`
- code quality â†’ `core/docs/programming/code-quality.md`
- emojis â†’ `core/docs/programming/EMOJIS_RULES.md`
- modificaÃ§Ã£o de cÃ³digo â†’ `core/docs/programming/CODE_MODIFICATION_RULES.md`

---

## checklist antes de escrever cÃ³digo

### criar api
- [ ] consultar `QUICK_START_API.md` primeiro
- [ ] criar todas as camadas (model, repository, validator, controller, api)
- [ ] versionamento obrigatÃ³rio (`/api/v1/`)
- [ ] seguir estrutura exata do guia
- [ ] nÃ£o pular camadas
- [ ] nÃ£o criar arquivos fora do padrÃ£o

### python
- [ ] type hints em todas as funÃ§Ãµes
- [ ] docstrings em padrÃ£o google (inglÃªs)
- [ ] repository pattern para acesso ao orm
- [ ] controller pattern para lÃ³gica de negÃ³cio
- [ ] validators para validaÃ§Ã£o de entrada
- [ ] sql puro apenas para select

### typescript/react
- [ ] typescript (nunca javascript)
- [ ] absolute imports (`@/components`, etc.)
- [ ] function components (nÃ£o classes)
- [ ] react.memo quando apropriado
- [ ] usecallback para handlers
- [ ] tailwind css (nÃ£o css inline)

### api rest
- [ ] versionamento (`/api/v1/`)
- [ ] resource-oriented urls
- [ ] status codes apropriados
- [ ] paginaÃ§Ã£o em list endpoints
- [ ] serializaÃ§Ã£o via serializers/pydantic

### seguranÃ§a
- [ ] nenhum secret hardcoded
- [ ] validaÃ§Ã£o de entrada
- [ ] sql injection prevention
- [ ] rate limiting

### git
- [ ] feature branch
- [ ] mensagem de commit descritiva
- [ ] testes passando
- [ ] cÃ³digo revisado

---

## violaÃ§Ãµes comuns

### nunca fazer
- âŒ criar api sem seguir estrutura de `QUICK_START_API.md`
- âŒ pular camadas (ex: lÃ³gica direto na view)
- âŒ criar arquivos fora do padrÃ£o estabelecido
- âŒ emojis no cÃ³digo (zero em projetos de trabalho)
- âŒ alterar cÃ³digo que nÃ£o foi pedido para alterar
- âŒ orm direto em views/controllers
- âŒ lÃ³gica de negÃ³cio em views
- âŒ validaÃ§Ã£o inline em controllers
- âŒ secrets hardcoded
- âŒ sql puro para insert/update/delete
- âŒ api sem versionamento
- âŒ commits sem mensagem descritiva
- âŒ cÃ³digo sem type hints
- âŒ javascript ao invÃ©s de typescript
- âŒ testes sem mocks (banco, fila, cache, APIs externas)
- âŒ coverage abaixo de 90% por arquivo
- âŒ carregar CSS legÃ­vel em produÃ§Ã£o (sempre .min.css)
- âŒ django sem health check, swagger, redoc, admin
- âŒ django sem error handler customizado
- âŒ django sem static files configurado corretamente

---

**version:** 3.0  
**last updated:** 2025-12-08  
**applies to:** all agents working with code

**esta documentaÃ§Ã£o Ã© a fonte de verdade para todos os padrÃµes de programaÃ§Ã£o. sempre consultar antes de implementar.**

---

## checklist expandido antes de escrever cÃ³digo

### emojis
- [ ] zero emojis em cÃ³digo (python, js, ts, css, html, configs)
- [ ] zero emojis em projetos de trabalho/work
- [ ] emojis apenas em README.md e notebooks jupyter (estudos)

### modificaÃ§Ã£o de cÃ³digo
- [ ] alterar apenas o que foi explicitamente solicitado
- [ ] nÃ£o fazer "melhorias" nÃ£o solicitadas
- [ ] nÃ£o remover cÃ³digo nÃ£o solicitado
- [ ] nÃ£o adicionar funcionalidades nÃ£o solicitadas

### testes
- [ ] estrutura espelhada (app/ â†’ tests/)
- [ ] mocks para banco, fila, cache, APIs externas
- [ ] coverage mÃ­nimo 90% por arquivo
- [ ] pytest.ini e conftest.py usando templates

### django
- [ ] seguir estrutura do User Service ExpenseIQ
- [ ] static files configurado (DEBUG + collectstatic + nginx)
- [ ] swagger, redoc, admin em urls.py
- [ ] error handler customizado (src/handlers.py)
- [ ] health check implementado
- [ ] usar cache_system.py, database.py padronizados

### css
- [ ] pasta styles/ com arquivos separados
- [ ] versÃµes .min.css criadas
- [ ] carregar apenas .min.css em produÃ§Ã£o
- [ ] carregar apenas arquivos necessÃ¡rios por pÃ¡gina

### configuraÃ§Ã£o
- [ ] entrypoint.sh sem cores/emojis
- [ ] Dockerfile.dev e Dockerfile.prod usando templates
- [ ] .editorconfig, .flake8, pytest.ini, conftest.py usando templates
- [ ] pyproject.toml seguindo boas prÃ¡ticas
- [ ] estrutura configs/ completa (docker-compose, nginx, .env)
