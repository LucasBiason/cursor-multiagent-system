# Cursor Multiagent System - Rules

## Context Saving
- **ALWAYS** save context after significant interactions
- Use `scripts/save_context.py` to save session context
- Update `config/CONTEXTO_COMPLETO_ATUAL.md` timestamp
- Commit changes to private config repository

## Multi-Machine Sync
- This system works across two machines (Linux + Windows via Tailscale)
- All agents MUST save context in `config/` directory
- Context is synced via private git submodule
- Never commit config/ to public repository

## Project Context
- Always check `config/CONTEXTO_COMPLETO_ATUAL.md` for current status
- Check `config/PROJETOS_DETALHADOS.md` for project details
- Update context files when projects change

## Important Rules
- **NO EMOJIS IN CODE** (Python, JavaScript, CSS, HTML, configs) - Only in Jupyter notebooks when explicitly teaching
- All code comments and docstrings in ENGLISH (except Jupyter tutorials)
- TypeScript for frontend
- Python type hints required
- Don't modify Django migrations manually
- Don't modify config files without explicit request
- **NEVER create status/feedback/summary files in client projects** (use chat or config/)
- Minimize documentation files - communicate via chat when done
- Views: Template views (serve HTML) vs API views (return JSON) - ALWAYS separate
- API versioning MANDATORY: `/{app}/api/v1/{resource}/`
- Template views: Only serve templates, no business logic, no ORM queries
- API views: Call controllers, return serialized data, no business logic
- Controllers: Orchestrate validators + repositories + services
- Validators: Input validation only, return {'valid': bool, 'error': str, 'data': dict}
- Repositories: ORM access only, no business logic
- Media files: `media/` with Docker volumes for persistence
- Static files: `static/` (source) + `staticfiles/` (collectstatic, gitignored)
- Controller returns: Objects (not dicts with 'success'/'error')
- API returns: Serialized objects + HTTP status (201/200/404/204)
- INSERT/UPDATE return serialized object, DELETE returns 204 No Content
- Management commands: App-specific → app/management/, Global → core/management/
- Nomenclature: Service = External API, Processor = Internal processing
- Templates: ALL in templates/ root, organized by app (templates/app_name/)
- Template paths: Relative to templates/ (e.g., 'dashboard/analytics.html')

## File Organization Rules

### Config Directory Structure
- **Root of config/**: ONLY permanent general context files
  - ✅ `CONTEXTO_COMPLETO_ATUAL.md`, `PROJETOS_DETALHADOS.md`, `user-context.md`, `system-context.md`
  - ✅ `config.json`, `notion-ids.json`, `schedule.md`, `README.md`
  - ✅ `INSTRUCOES_SINCRONIZACAO.md`, `RESUMO_REPOSITORIO.md`, `cursor_mcp_config.json`
  - ❌ NO temporary planning files, NO project-specific docs, NO session summaries, NO guides

### Temporary Files Location
- **Planning documents**: `config/system/planning/` (temporary plans, daily schedules, executive summaries)
- **Session summaries**: `config/sessions/` (format: `YYYYMMDD_HHMMSS_context.md`)
- **Project-specific context**: `config/work/`, `config/studies/`, `config/personal/` (by domain)

### Scripts and Disposable Files
- **Scripts e Deploys/**: ONLY disposable scripts (.py, .sh), test files, deployment scripts, logs (.log)
- **Context documents**: MUST be in `config/` (see `config/system/MAPEAMENTO_ASSUNTOS.md` for precise mapping)
- **Logs**: Keep in Scripts e Deploys/ or ignore (never in config/)
- **Binary files**: Google Drive or local (never in config/)
- **JSON temporários**: Scripts e Deploys/ (checkpoints, dados processados)

### File Classification Flow
1. **Is it context?** (documentation, analysis, planning, guides, reports)
   - ✅ YES → `config/`
   - ❌ NO → `Scripts e Deploys/` or delete
2. **Is it permanent?**
   - ✅ YES → `config/{domain}/{project}/`
   - ❌ NO → `config/system/planning/` or `config/sessions/`
3. **Which domain?**
   - Work → `config/work/`
   - Studies → `config/studies/`
   - Personal → `config/personal/`
   - System/Infra → `config/system/`
   - YouTube → `config/youtube/`
   - Gaming → `config/gaming/`
   - Social → `config/social/`

### Documents from Scripts e Deploys
- **README.md files**: Move to appropriate `config/` subdirectory (NOT scripts)
- **Analysis/Planning docs**: Move to `config/{domain}/projects/{project}/` or `config/system/`
- **Reports**: Move to `config/{domain}/` or `config/system/`
- **Guides/Tutorials**: Move to `config/{domain}/` or `config/system/Automacao/`
- **Mappings/Structures**: Move to `config/system/infrastructure/`
- **Corrections/Diagnostics**: Move to `config/{domain}/{project}/`
- **NEVER leave context documents in Scripts e Deploys/**

### Precise Mapping
See `config/system/MAPEAMENTO_ASSUNTOS.md` for detailed mapping of:
- Where each type of file should go
- Examples of file classification
- Rules for specific file types
- Checklist before creating/moving files

## Context Files Location
- Main context: `config/CONTEXTO_COMPLETO_ATUAL.md`
- Projects: `config/PROJETOS_DETALHADOS.md`
- User: `config/user-context.md`
- System: `config/system-context.md`
- Sessions: `config/sessions/`
- Mapping: `config/system/MAPEAMENTO_ASSUNTOS.md` (where to put each type of file)

## After Each Interaction
1. Save context using `save_context.py`
2. Update relevant context files
3. Move temporary files to appropriate folders
4. Commit to private repository (automatic)

## Detailed Rules Documentation
All rules are documented in `core/docs/rules/`. Key rules:

### Architecture Patterns (MANDATORY)
- **REPOSITORY_PATTERN_OBRIGATORIO.md** - Data access layer, ORM encapsulation
- **CONTROLLER_PATTERN_OBRIGATORIO.md** - Business logic orchestration
- **SEPARACAO_VIEWS_TEMPLATES_API.md** - Template views vs API views separation

### API Standards (MANDATORY)
- **API_VERSIONING_OBRIGATORIO.md** - Versioned APIs (/{app}/api/v1/)
- **VALIDATORS_OBRIGATORIO.md** - Input validation layer
- **RETORNOS_CONTROLLERS_E_APIS.md** - Standard return types (objects, not dicts)

### Data Access (MANDATORY)
- **SQL_PURO_APENAS_SELECT.md** - Raw SQL only for SELECT, ORM for INSERT/UPDATE/DELETE
- **NOMENCLATURA_SERVICES.md** - Service = External API, Processor = Internal logic

### Organization (MANDATORY)
- **TEMPLATES_ORGANIZACAO.md** - All templates in templates/ root, by app
- **MANAGEMENT_COMMANDS_ORGANIZACAO.md** - App commands vs Core commands
- **NO_STATUS_FILES_IN_CLIENT_PROJECTS.md** - Status files go to config/, not client projects

### Security
- **SECURITY_SECRETS.md** - Environment variables, credential management
